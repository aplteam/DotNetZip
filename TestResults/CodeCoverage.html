<!DOCTYPE html>
<html lang="en">
<head>
<title>Coverage</title>
<meta charset="utf-8"/>
<style>
@media screen{
    html {background-color: #FFFFF0;}
body {
    font-size: 16px;
    font-family : Verdana, "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
    margin: 1em;
}
th, td {padding: 5px 10px;}
th {text-align: left;}
h1, h2, h3, h4, h5, h6 {color: #424242;}
h1 {font-size: 22px;}
h2 {font-size: 18px; margin-top: 2em; margin-bottom:0.3em;}
tbody tr:nth-child(even) {background-color: #F0F0F0;}
tbody tr:nth-child(odd) {background-color: #FAFAFA;}
th {background-color: #E6E6E6;color: #424242;}
table {border: silver 1px solid; font-size: 14px;font-family: APLFont, monospace;}
code , code a {font-size: 14px; font-family: APLFont, monospace;}
code.header {
    font-size: 16px; 
    font-family: APLFont, monospace; 
    margin: 1.5em 0.5em 0 0.5em; 
    padding:0;
    display: block;
}
div.code-block {
    border: 1px silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 0.5em 0.5em 0.5em 0.5em;
    padding: 0.5em;
}
div.code-block.missing {
    background-color: #fa605254;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
ul li, ol li {margin: 0.7em 0.2em;}
.float-right {float:right;}
.no-underline {    text-decoration :none;}
.top-links {font-size:20px; padding-left: 0.6em;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5px; padding-top:0; font-size: 9px;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 0.5em; padding: 0.5em;}
}
@media print{@page {size: portrait}
@page {
    margin: 1cm 1cm 1cm 1.75cm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
  }
}
body {
    font: 12pt "Times New Roman", Times, serif;
    line-height: 1.2;
     /* CSS3 filter, at the moment Webkit only. Prefix it for future implementations */
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%); /* future-proof */
}
h1 {font-size: 18pt;}
h2 {font-size: 16pt; margin-top: 10pt; margin-bottom: 3pt;}
th, td {padding: 2pt 3pt;}
th {text-align: left;background-color: #DBDBDB;}
tbody tr:nth-child(odd) {background-color: #EDEDED;}
table {
    color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    font-size: 8pt;
    font-family: APLFont, monospace;
}
div.keep-together {break-inside: avoid; break-before:auto;}
table {border: silver 1pt solid;}
code , code a {font-size: 8pt; font-family: APLFont, monospace;}
code.header {
    font-size: 8pt;
    font-family: APLFont, monospace;
    margin: 7pt 3pt 0 10pt;
    padding:0;
    display: block;
}
div.code-block {
    border: 1pt silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 4pt 4pt 4pt 4pt;
    padding: 4pt;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
a {text-decoration: none;color: black;}
ul li, ol li {margin: 8pt 3pt;}
.no-print {display:none;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5pt; padding-top:0; font-size: 6pt;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 8px; padding: 8px;}
}
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.js"></script>
</head>
<body>
<h1 id="top">Coverage Report</h1>
<p>Watched: 22 fns/opr within <code>#.DotNetZip.DotNetZip</code></p>
<p>The test suite was executed once:</p>
<table>
<thead>
<tr><th>Executed at</th><th>APLVersion</th><th>Memory (MB)</th></tr>
</thead>
<tbody>
<tr><td>2024-06-26 13:01:38</td><td>Windows-64 ⋄ 19.0.49376.0 ⋄ W ⋄ Development ⋄ Unicode</td><td>115</td></tr>
</tbody>
</table>
<p>Overall 88% of the testable code is covered.</p>
<p>(Comment lines, empty lines, all <code>:End</code>* lines etc. are ignored)</p>
<p>14 of the fns/opr are 100% covered.</p>
<div id="partly-covered" class="keep-together">
<table id="percent">
<thead>
<tr><th style="text-align:left;">Function/Operator</th><th style="text-align:left;">Lines not executed</th><th style="text-align:left;">Coverage</th><th style="text-align:right;">≢</th></tr>
</thead>
<tbody>
<tr class="uncovered"><td><a href="#listing_1" title="Link to listing">#.DotNetZip.DotNetZip.Version</a></td><td>2</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_2" title="Link to listing">#.DotNetZip.DotNetZip.ZipFolder_</a></td><td>5←≢4-8</td><td>0</td><td>5</td></tr>
<tr><td><a href="#listing_3" title="Link to listing">#.DotNetZip.DotNetZip.QuadNEW</a></td><td>5←≢10-13,15</td><td>58</td><td>12</td></tr>
<tr><td><a href="#listing_4" title="Link to listing">#.DotNetZip.DotNetZip.UnzipTo</a></td><td>12, 13</td><td>67</td><td>6</td></tr>
<tr><td><a href="#listing_5" title="Link to listing">#.DotNetZip.DotNetZip.Cleanup</a></td><td>6</td><td>80</td><td>5</td></tr>
<tr><td><a href="#listing_6" title="Link to listing">#.DotNetZip.DotNetZip.ZipFolder</a></td><td>13</td><td>90</td><td>10</td></tr>
<tr><td><a href="#listing_7" title="Link to listing">#.DotNetZip.DotNetZip.Initialize</a></td><td>9</td><td>90</td><td>10</td></tr>
<tr><td><a href="#listing_8" title="Link to listing">#.DotNetZip.DotNetZip.make</a></td><td>30, 31</td><td>93</td><td>30</td></tr>
<tr class="fullyCovered"><td><a href="#listing_9" title="Link to listing">#.DotNetZip.DotNetZip.set_ filename</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_10" title="Link to listing">#.DotNetZip.DotNetZip.get_ filename</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_11" title="Link to listing">#.DotNetZip.DotNetZip.History</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_12" title="Link to listing">#.DotNetZip.DotNetZip.make1</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_13" title="Link to listing">#.DotNetZip.DotNetZip.make2</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_14" title="Link to listing">#.DotNetZip.DotNetZip.Add</a></td><td></td><td>100</td><td>20</td></tr>
<tr class="fullyCovered"><td><a href="#listing_15" title="Link to listing">#.DotNetZip.DotNetZip.ExtractTo</a></td><td></td><td>100</td><td>18</td></tr>
<tr class="fullyCovered"><td><a href="#listing_16" title="Link to listing">#.DotNetZip.DotNetZip.List</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_17" title="Link to listing">#.DotNetZip.DotNetZip.Delete</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_18" title="Link to listing">#.DotNetZip.DotNetZip.Dispose</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_19" title="Link to listing">#.DotNetZip.DotNetZip.ListZipContents</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_20" title="Link to listing">#.DotNetZip.DotNetZip.Add_</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_21" title="Link to listing">#.DotNetZip.DotNetZip.QEX_System</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_22" title="Link to listing">#.DotNetZip.DotNetZip.parent</a></td><td></td><td>100</td><td>0</td></tr>
</tbody>
</table>
</div>
<script>
$(document).ready(function() {
    var oTable;
    oTable = $("#percent").DataTable( {
        paging:   false,
        ordering: true,
        info:     true,
        fixedHeader: true,
        order: [2,"asc"],
        dom: "Bft",
        drawCallback: function( settings ) {
             var api = this.api();
             $('.header[id^="listing_"]').next().addBack().css("display","none");
             api.rows( {page:"current"} ).data().each(function(data){
              id = data[0];
              id = id.match(/"(\#.*?)"/);
              if (id){$(id[1]).next().addBack().css("display","block");}
             })
        },      
        buttons: [
        {
            text: "Partly covered (6)",
            titleAttr: "50%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^(?!(0%|100%)).*";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Uncovered (2)",
            titleAttr: "0%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^0%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Fully covered (14)",
            titleAttr: "100%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "100%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "All (22)",
            titleAttr: "all",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = ".";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
    ],
 
        columnDefs: [
            {className: "align-right", targets: [2,3]
            },
            {
                render: function ( data, type, row, meta ) {
                            return data+"%" ;        
                        },
                targets: 2
            }
        ]             
    } );
    oTable.button(0).trigger();

} );    
</script>
<h2>Listings</h2>
<code class="header" id="listing_1">#.DotNetZip.DotNetZip.Version &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Version</code>
<code> [1]  :Access Public Shared</code>
<code class="emphasize">→[2]  r←'DotNetZip' '2.2.0+67' '2023-02-26'</code>
</div>
<code class="header" id="listing_2">#.DotNetZip.DotNetZip.ZipFolder_ &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {targetFile}←sourceFolder ZipFolder_ targetFile</code>
<code> [1]      ⍝ Takes a folder and zips it. `target` must not exist.\\</code>
<code> [2]      ⍝ Returns the fully expanded name of the `targetFile`.</code>
<code> [3]      ⍝  :Access Public Shared</code>
<code class="emphasize">→[4]   Initialize ⍬</code>
<code class="emphasize">→[5]   targetFile←F.ExpandPath AddExtension targetFile</code>
<code class="emphasize">→[6]   sourceFolder←F.ExpandPath sourceFolder</code>
<code class="emphasize">→[7]   QEX_System</code>
<code class="emphasize">→[8]   System.IO.Compression.ZipFile.CreateFromDirectory sourceFolder targetFile</code>
<code> [9]      ⍝Done</code>
</div>
<code class="header" id="listing_3">#.DotNetZip.DotNetZip.QuadNEW &mdash; 58%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←QuadNEW arg</code>
<code> [1]      ⍝ Attempts to be successful several times in case of "being used by another process" errors with</code>
<code> [2]      ⍝ increasingly long delays. This often occured when `DotNetZip` itself had just dealt with the zip file,</code>
<code> [3]      ⍝ and it almost always goes away after some tries.</code>
<code> [4]   success←counter←0</code>
<code> [5]   :Repeat</code>
<code> [6]       :Trap 90</code>
<code> [7]           r←⎕NEW arg</code>
<code> [8]           success←1</code>
<code> [9]       :Else</code>
<code class="emphasize">→[10]          qdmx←⎕DMX</code>
<code class="emphasize">→[11]          :If ∨/'because it is being used by another process'⍷⍕⎕EXCEPTION</code>
<code class="emphasize">→[12]              counter+←1</code>
<code class="emphasize">→[13]              ⎕DL 0.2×counter</code>
<code> [14]          :Else</code>
<code class="emphasize">→[15]              qdmx.EM ⎕SIGNAL qdmx.EN</code>
<code> [16]          :EndIf</code>
<code> [17]      :EndTrap</code>
<code> [18]  :Until success∨10&lt;counter</code>
<code> [19]  ('⎕NEW failed ',(⍕counter),' times')⎕SIGNAL 11/⍨10&lt;counter</code>
</div>
<code class="header" id="listing_4">#.DotNetZip.DotNetZip.UnzipTo &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←zipfile UnzipTo targetFolder</code>
<code> [1]      ⍝ Unzip `⍺` into `⍵`.\\</code>
<code> [2]      ⍝ `targetFolder` must not yet exist.</code>
<code> [3]   :Access Public Shared</code>
<code> [4]   r←Initialize ⍬</code>
<code> [5]   QEX_System</code>
<code> [6]   :Trap 6</code>
<code> [7]       System.IO.Compression.ZipFile.ExtractToDirectory zipfile targetFolder</code>
<code> [8]   :Else</code>
<code> [9]            ⍝ Workaround for bug Mantis 18404 from 2020-08</code>
<code> [10]           ⍝ The VALUE ERROR is not really a VALUE ERROR. This appears to happen only when `DotNetZip` is</code>
<code> [11]           ⍝ instanciated within `⎕SE`, then )CLEAR is issed and then `DotNetZip` is again instanciated within `⎕SE`.</code>
<code class="emphasize">→[12]      ⎕EX'System'</code>
<code class="emphasize">→[13]      System.IO.Compression.ZipFile.ExtractToDirectory zipfile targetFolder</code>
<code> [14]  :EndTrap</code>
<code> [15]     ⍝Done</code>
</div>
<code class="header" id="listing_5">#.DotNetZip.DotNetZip.Cleanup &mdash; 80%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Cleanup</code>
<code> [1]  :Implements Destructor</code>
<code> [2]       ⍝ Calls the `Dispose` method and deletes `_zip`</code>
<code> [3]  :Trap 6 90</code>
<code> [4]      _zip.Dispose</code>
<code> [5]  :Case 90</code>
<code class="emphasize">→[6]      Assert'Cannot access a closed file.'≡⎕EXCEPTION.Message</code>
<code> [7]  :EndTrap</code>
<code> [8]  ⎕EX'_zip'</code>
</div>
<code class="header" id="listing_6">#.DotNetZip.DotNetZip.ZipFolder &mdash; 90%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {zipFilename}←sourceFolder ZipFolder zipFilename</code>
<code> [1]      ⍝ Takes a folder and zips it. `zipFilename` must not exist.\\</code>
<code> [2]      ⍝ Returns the fully expanded name of `zipFilename`.\\</code>
<code> [3]      ⍝ This is a workaround thats gets around the `\` problem on Linux and Mac-OS.\\</code>
<code> [4]      ⍝ The "real" solution is available under the name `ZipFolder_` and can be brought back once</code>
<code> [5]      ⍝ Microsoft fixes the bug, which means probably not in the foreseeable future.</code>
<code> [6]   :Access Public Shared</code>
<code> [7]   ∆INIT←0</code>
<code> [8]   Initialize ⍬</code>
<code> [9]   sourceFolder,←((0&lt;≢sourceFolder)∧~'/\'∊⍨¯1↑sourceFolder)/'/'</code>
<code> [10]  fileList←'recursive'F.ListFiles sourceFolder</code>
<code> [11]  fileList←(≢sourceFolder)↓¨fileList</code>
<code> [12]  :If ~∧/b←⎕NEXISTS sourceFolder∘,¨fileList</code>
<code class="emphasize">→[13]      ('',⊃{⍺,',',⍵}/(~b)/fileList)Assert 0</code>
<code> [14]  :Else</code>
<code> [15]      myZip←⎕NEW ⎕THIS(,⊂zipFilename)</code>
<code> [16]      sourceFolder∘myZip.Add¨fileList</code>
<code> [17]      zipFilename←myZip.filename</code>
<code> [18]  :EndIf</code>
</div>
<code class="header" id="listing_7">#.DotNetZip.DotNetZip.Initialize &mdash; 90%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←Initialize dummy</code>
<code> [1]   r←⍬</code>
<code> [2]   CheckMinVersion ⍬</code>
<code> [3]   :If 0=∆INIT</code>
<code> [4]       F←(⊃⊃⎕CLASS ⎕THIS).##.FilesAndDirs</code>
<code> [5]       notwindows←'Win'≢3↑⊃# ⎕WG'APLVersion'</code>
<code> [6]       netcoreset←(,'1')≡2 ⎕NQ'.' 'GetEnvironment' 'DYALOG_NETCORE'</code>
<code> [7]       :If notwindows∨netcoreset                      ⍝ Under Windows, switch selects .NET version</code>
<code> [8]                ⍝ .NET Core bridge: Lookup by name:</code>
<code class="emphasize">→[9]           ⎕USING←',System.IO.Compression.ZipFile' ',System.IO.Compression' ',System.IO.FileSystem'</code>
<code> [10]      :Else</code>
<code> [11]          ⎕USING←',System.IO.Compression.DLL' ',System.IO.Compression.FileSystem.DLL'</code>
<code> [12]      :EndIf</code>
<code> [13]      ∆INIT←1</code>
<code> [14]  :EndIf</code>
</div>
<code class="header" id="listing_8">#.DotNetZip.DotNetZip.make &mdash; 93%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  make(zipFilename overwriteFlag)</code>
<code> [1]   CheckMinVersion ⍬</code>
<code> [2]   Initialize ⍬</code>
<code> [3]   zipFilename←AddExtension F.ExpandPath zipFilename</code>
<code> [4]   QEX_System</code>
<code> [5]   :If doesExist←F.Exists zipFilename</code>
<code> [6]   :AndIf 0=overwriteFlag</code>
<code> [7]       flag←counter←0</code>
<code> [8]       :Repeat</code>
<code> [9]           :Trap 90</code>
<code> [10]              stream←System.IO.File.Open(zipFilename System.IO.FileMode.Open)</code>
<code> [11]              flag←1</code>
<code> [12]          :Else</code>
<code> [13]              msg←⍕⊃⎕EXCEPTION</code>
<code> [14]              :If ~∨/'The process cannot access the file'⍷msg</code>
<code> [15]              :OrIf 5=counter←counter+1</code>
<code> [16]                  99 ⎕SIGNAL⍨{⍵↓⍨1+⍵⍳':'}{⍵↑⍨¯1+⌊/⍵⍳⎕UCS 10 13}∊msg</code>
<code> [17]              :Else</code>
<code> [18]                  ⎕DL 0.1</code>
<code> [19]              :EndIf</code>
<code> [20]          :EndTrap</code>
<code> [21]      :Until flag</code>
<code> [22]      _zip←QuadNEW System.IO.Compression.ZipArchive(stream System.IO.Compression.ZipArchiveMode.Update)</code>
<code> [23]  :Else</code>
<code> [24]      :If doesExist</code>
<code> [25]          ('Cannot delete ',zipFilename)Assert F.DeleteFile zipFilename</code>
<code> [26]      :EndIf</code>
<code> [27]      :Trap 90</code>
<code> [28]          stream←System.IO.File.Open(zipFilename System.IO.FileMode.CreateNew)</code>
<code> [29]      :Else</code>
<code class="emphasize">→[30]          msg←⍕⊃⎕EXCEPTION</code>
<code class="emphasize">→[31]          99 ⎕SIGNAL⍨{⍵↓⍨1+⍵⍳':'}{⍵↑⍨¯1+⌊/⍵⍳⎕UCS 10 13}∊msg</code>
<code> [32]      :EndTrap</code>
<code> [33]      _zip←QuadNEW System.IO.Compression.ZipArchive(stream System.IO.Compression.ZipArchiveMode.Create)</code>
<code> [34]      _zip.Dispose</code>
<code> [35]           ⍝ `List` is not available in "Create" mode, so we re-open it</code>
<code> [36]      stream←System.IO.File.Open(zipFilename System.IO.FileMode.Open)</code>
<code> [37]      _zip←QuadNEW System.IO.Compression.ZipArchive(stream System.IO.Compression.ZipArchiveMode.Update)</code>
<code> [38]  :EndIf</code>
<code> [39]  _zip.⎕DF'[archive:',zipFilename,']'</code>
<code> [40]  _filename←zipFilename</code>
<code> [41]     ⍝Done</code>
</div>
<code class="header" id="listing_9">#.DotNetZip.DotNetZip.set_ filename &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<code class="header" id="listing_10">#.DotNetZip.DotNetZip.get_ filename &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<code class="header" id="listing_11">#.DotNetZip.DotNetZip.History &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  History</code>
<code> [1]   :Access Public Shared</code>
<code> [2]      ⍝ * 2.2.0 from 2024-06-26</code>
<code> [3]      ⍝   * On very fast machines this could run into</code>
<code> [4]      ⍝     "The process cannot access the file ... because it is being used by another process"</code>
<code> [5]      ⍝     We now wait for a moment and then try again, up to 5 times</code>
<code> [6]      ⍝ * 2.1.0 from 2023-02-01</code>
<code> [7]      ⍝   * Constructor is now more resilient against a temporary "File is in use" problem.</code>
<code> [8]      ⍝ * 2.0.2 from 2022-05-31</code>
<code> [9]      ⍝   * Bug fixed in "Delete"</code>
<code> [10]     ⍝ * 2.0.1 from 2022-05-20</code>
<code> [11]     ⍝   * Bug fixed in "Delete"</code>
<code> [12]     ⍝   * Documentation fixed regarding `overwriteFlag` and `UnzipTo`</code>
<code> [13]     ⍝   * Test cases polished</code>
<code> [14]     ⍝ * 2.0.0 from 2022-05-18</code>
<code> [15]     ⍝   * The constructor now checks whether .NET (core) is really available, and throws an error</code>
<code> [16]     ⍝     if it is not.</code>
<code> [17]     ⍝   * Documentation polished.</code>
<code> [18]     ⍝   * Now managed by Cider rather than acre.</code>
<code> [19]     ⍝ * 1.0.2 from 2021-03-01</code>
<code> [20]     ⍝   * Problem with backslash as separator fixed</code>
<code> [21]     ⍝   * Package config corrected</code>
<code> [22]     ⍝ * 1.0.1 from 2021-01-10</code>
<code> [23]     ⍝   * Paths are written to a ZIP file with / rather than \, no matter what the platform is.</code>
<code> [24]     ⍝     Only then can we be sure that it will work on Linux and Mac-OS due to bugs in many</code>
<code> [25]     ⍝     versions of .NET and .NET Core.\\</code>
<code> [26]     ⍝     `ZipFolder` does not call the corresponding .NET method in order to overcome the \ bug.</code>
<code> [27]     ⍝   * The `Add` function now checks the existence of any file. Sometimes non-existent files</code>
<code> [28]     ⍝     did not cause the .NET call to crash.</code>
<code> [29]     ⍝ * 1.0.0 from 2020-09-21</code>
<code> [30]     ⍝   * First official release. Requires Dyalog 18.0 and is delivered as a Tatin package</code>
</div>
<code class="header" id="listing_12">#.DotNetZip.DotNetZip.make1 &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  make1(zipFilename)</code>
<code> [1]      ⍝ Constructor that takes just one argument: the name of the ZIP file.\\</code>
<code> [2]      ⍝ If `zipFilename` already exists it is kind of opened.</code>
<code> [3]   :Access Public Instance</code>
<code> [4]   :Implements Constructor</code>
<code> [5]   overwriteFlag←0</code>
<code> [6]   counter←success←0</code>
<code> [7]   :Repeat</code>
<code> [8]       :Trap 99      ⍝ This can happen on very fast machines</code>
<code> [9]           make zipFilename overwriteFlag</code>
<code> [10]          success←1</code>
<code> [11]      :Else</code>
<code> [12]          ⎕DL 0.1   ⍝ The solution is to wait some time and then try again</code>
<code> [13]      :EndTrap</code>
<code> [14]  :Until 5&lt;counter←counter+1</code>
<code> [15]  :If 0=success</code>
<code> [16]      ⎕EXCEPTION.Message ⎕SIGNAL 99</code>
<code> [17]  :EndIf</code>
<code> [18]     ⍝Done</code>
</div>
<code class="header" id="listing_13">#.DotNetZip.DotNetZip.make2 &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  make2(zipFilename overwriteFlag)</code>
<code> [1]      ⍝ Constructor that takes two arguments:</code>
<code> [2]      ⍝ * the name of the ZIP file</code>
<code> [3]      ⍝ * Boolean for `overwriteFlag`\\</code>
<code> [4]      ⍝ `overwriteFlag` is used to determine whether the ZIP should be opened (0=default)</code>
<code> [5]      ⍝ or overwritten (1).</code>
<code> [6]   :Access Public Instance</code>
<code> [7]   :Implements Constructor</code>
<code> [8]   '"overwriteFlag" must be a Boolean'⎕SIGNAL 11/⍨~(⊂overwriteFlag)∊0 1</code>
<code> [9]   make zipFilename overwriteFlag</code>
<code> [10]     ⍝Done</code>
</div>
<code class="header" id="listing_14">#.DotNetZip.DotNetZip.Add &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{parent}Add toBeZipped</code>
<code> [1]      ⍝ Use this to add one or more files to the ZIP file.\\</code>
<code> [2]      ⍝ `toBeZipped` specifies the full path (or full paths) of what's going to be zipped. That's what's going to be</code>
<code> [3]      ⍝ stored in the ZIP file.\\</code>
<code> [4]      ⍝ If `toBeZipped` refers to a full path as in `C:\Foo.txt` or `/tmp/myfile` or, much more likely, refers to</code>
<code> [5]      ⍝ the current directory as in `./foo.txt` then there is no need to specify the optional left argument.\\</code>
<code> [6]      ⍝ If however you want to store the file `C:\Projects\Foo\docs\ReadMe.txt`, but it should be saved in the ZIP</code>
<code> [7]      ⍝ file as `docs\ReadMe.txt`, then you must call `Add` like this:</code>
<code> [8]      ⍝ ```</code>
<code> [9]      ⍝ `C:\Projects\Foo` myDotNetZip.Add `docs\ReadMe.txt`</code>
<code> [10]     ⍝ ```</code>
<code> [11]     ⍝ Notes:</code>
<code> [12]     ⍝ * `parent` might or might not have a trailing separator, and `toBeZipped` might or might not have a</code>
<code> [13]     ⍝ leading separator: `Add` works that out.</code>
<code> [14]     ⍝ * While `parent`, if specified, must be a simple string, `toBeZipped` might be simple (single file) or nested, when</code>
<code> [15]     ⍝ every single item is treated as the name of a file or a folder.\\</code>
<code> [16]     ⍝ Returns `⍬` (shy).</code>
<code> [17]  :Access Public Instance</code>
<code> [18]  r←⍬</code>
<code> [19]  parent←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'parent'</code>
<code> [20]  parent←F.EnforceSlash{0=≢⍵:⍵ ⋄ ⍵,(~'/\'∊⍨¯1↑⍵)/F.CurrentSep}parent</code>
<code> [21]  :If (≡toBeZipped)∊0 1</code>
<code> [22]      toBeZipped←{⍵↓⍨'/\'∊⍨1⍴⍵}toBeZipped</code>
<code> [23]      toBeZipped←F.EnforceSlash toBeZipped</code>
<code> [24]      :If F.IsDir parent,toBeZipped</code>
<code> [25]          :If 0&lt;≢list←⊃('recursive' 1)F.Dir parent,toBeZipped,'/*'</code>
<code> [26]          :AndIf 0&lt;≢list←(F.IsFile list)/list</code>
<code> [27]              list←(≢parent)↓¨list</code>
<code> [28]              list←F.EnforceSlash¨list</code>
<code> [29]              parent∘Add_¨list</code>
<code> [30]          :EndIf</code>
<code> [31]      :Else</code>
<code> [32]          parent Add_ toBeZipped</code>
<code> [33]      :EndIf</code>
<code> [34]  :Else</code>
<code> [35]      toBeZipped←{⍵↓⍨'/\'∊⍨1⍴⍵}¨toBeZipped</code>
<code> [36]      toBeZipped←F.EnforceSlash¨toBeZipped</code>
<code> [37]      isDir←F.IsDir parent∘,¨toBeZipped</code>
<code> [38]      :If ∨/~isDir</code>
<code> [39]          parent∘Add_¨(~isDir)/toBeZipped</code>
<code> [40]      :EndIf</code>
<code> [41]      :If ∨/isDir</code>
<code> [42]          parent∘Add¨isDir/toBeZipped</code>
<code> [43]      :EndIf</code>
<code> [44]  :EndIf</code>
</div>
<code class="header" id="listing_15">#.DotNetZip.DotNetZip.ExtractTo &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←names ExtractTo folder</code>
<code> [1]      ⍝ `names` is the name of one or more zipped objects (files or directories).</code>
<code> [2]      ⍝ Those will be extracted into `folder\`.\\</code>
<code> [3]      ⍝ `names` may be simple (single object) or nested (vector of objects).\\</code>
<code> [4]      ⍝ There must be no file or folder of the given name in the target folder, otherwise an error is thrown.\\</code>
<code> [5]      ⍝ `r` is a vector of Booleans with the same lengths as `names`, carrying 1 for success and 0  otherwise.</code>
<code> [6]      ⍝ However, if `names` is or contains the name of a folder, the length of `r` may be smaller than the</code>
<code> [7]      ⍝ number of files and folders extracted.</code>
<code> [8]      ⍝ A typical reason for a failure is that a given file or folder does not exist in the ZIP file.</code>
<code> [9]   :Access Public Instance</code>
<code> [10]  names←,⊆names</code>
<code> [11]  r←(≢names)⍴0</code>
<code> [12]  :For i :In ⍳≢names</code>
<code> [13]      name←F.EnforceSlash i⊃names</code>
<code> [14]      :If ⎕NULL≢entry←_zip.GetEntry⊂name</code>
<code> [15]          targetFilename←F.NormalizePath folder,'/',name</code>
<code> [16]          :Trap 90</code>
<code> [17]              'Create!'F.CheckPath 1⊃⎕NPARTS targetFilename</code>
<code> [18]              QEX_System</code>
<code> [19]              System.IO.Compression.ZipFileExtensions.ExtractToFile(entry targetFilename)</code>
<code> [20]              r[i]←1</code>
<code> [21]          :Else</code>
<code> [22]              ⎕EXCEPTION.Message ⎕SIGNAL 11</code>
<code> [23]          :EndTrap</code>
<code> [24]      :Else</code>
<code> [25]          :If 0&lt;≢list←List</code>
<code> [26]          :AndIf 0&lt;≢≢∪(1⊃¨⎕NPARTS list)~⊂''</code>
<code> [27]              sep←('\'∊∊list)⌽'/\'</code>
<code> [28]              name←(sep[1]@(⍸name=sep[2]))name</code>
<code> [29]          :AndIf 0&lt;≢list←(((1+≢name)↑[2]↑list)∧.=name,sep[1])/list</code>
<code> [30]              r[i]←⊃∨/list ExtractTo¨⊂folder</code>
<code> [31]          :EndIf</code>
<code> [32]      :EndIf</code>
<code> [33]  :EndFor</code>
</div>
<code class="header" id="listing_16">#.DotNetZip.DotNetZip.List &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←List</code>
<code> [1]     ⍝ Lists the contents of the ZIP file.</code>
<code> [2]  :Access Public Instance</code>
<code> [3]  collection←⌷_zip.Entries</code>
<code> [4]  r←collection.ToString</code>
</div>
<code class="header" id="listing_17">#.DotNetZip.DotNetZip.Delete &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←Delete filenames</code>
<code> [1]      ⍝ Delete one or more files from the ZIP.\\</code>
<code> [2]      ⍝ Returns `⍬` (shy).</code>
<code> [3]   :Access Public Instance</code>
<code> [4]   r←⍬</code>
<code> [5]   filenames←F.EnforceSlash¨⊆filenames</code>
<code> [6]   :If 0&lt;+/bool←(⍕¨⌷_zip.Entries)∊F.EnforceSlash¨⊆filenames</code>
<code> [7]       toBeDeleted←bool/⌷_zip.Entries</code>
<code> [8]       toBeDeleted.Delete</code>
<code> [9]   :EndIf</code>
</div>
<code class="header" id="listing_18">#.DotNetZip.DotNetZip.Dispose &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←Dispose</code>
<code> [1]      ⍝ Use this to close the `DotNetZip` instance.\\</code>
<code> [2]      ⍝ Note that deleteting a instance of `DotNetZip` has the same effect as calling this method although the timing might differ</code>
<code> [3]      ⍝ Returns `⍬` (shy).</code>
<code> [4]   :Access Public Instance</code>
<code> [5]   r←⍬</code>
<code> [6]   :If 0&lt;⎕NC'_zip'</code>
<code> [7]       _zip.Dispose</code>
<code> [8]       ⎕EX'_zip'</code>
<code> [9]   :EndIf</code>
</div>
<code class="header" id="listing_19">#.DotNetZip.DotNetZip.ListZipContents &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ListZipContents zipfile</code>
<code> [1]  :Access Public Shared</code>
<code> [2]     ⍝ Helper that instantiates the `DotNetZip` class temporarily just for the purpose of unzipping a zip file.</code>
<code> [3]  myZip←QuadNEW ⎕THIS(zipfile 0)</code>
<code> [4]  r←myZip.List</code>
</div>
<code class="header" id="listing_20">#.DotNetZip.DotNetZip.Add_ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←parent Add_ toBeZipped</code>
<code> [1]  ('Files does not exist: ',parent,toBeZipped)Assert ⎕NEXISTS parent,toBeZipped</code>
<code> [2]  Delete toBeZipped      ⍝ Remove from ZIP file, simulating "overwrite"</code>
<code> [3]  QEX_System</code>
<code> [4]  r←System.IO.Compression.ZipFileExtensions.CreateEntryFromFile _zip(parent,toBeZipped)toBeZipped</code>
</div>
<code class="header" id="listing_21">#.DotNetZip.DotNetZip.QEX_System &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←QEX_System</code>
<code> [1]       ⍝ Workaround for bug Mantis 18404 from 2020-08</code>
<code> [2]       ⍝ The VALUE ERROR is not really a VALUE ERROR. This appears to happen only when `DotNetZip` is instanciated</code>
<code> [3]       ⍝ within `⎕SE`, then )CLEAR is issued and then again `DotNetZip` instanciated within `⎕SE`.</code>
<code> [4]  r←⎕EX'System'</code>
</div>
<code class="header" id="listing_22">#.DotNetZip.DotNetZip.parent &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<div id="footer">
<hr>
<p>Created by "CodeCoverage" version 0.10.7+52 from 2024-06-05</p>
</div>

</body>
</html>
